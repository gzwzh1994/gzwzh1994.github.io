<!doctype html><html class="theme-next mist use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css"><meta name="keywords" content="LVM,Linux,"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1"><meta name="description" content="LVM简介
LVM全称Logical Volume Manager(逻辑卷管理)，是将几个物理分区(或硬盘)通过软件组合成一块看起来是独立大硬盘(VG)，然后对这块大硬盘分割成可使用的逻辑卷(LV)，最终能够挂载使用，以达到对磁盘空间进行弹性管理的目的。


LVM的基本原理基本术语dm(device mapper)：将一个或多个底层块设备组织成一个逻辑设备的模块PV(Physical Volum"><meta property="og:type" content="article"><meta property="og:title" content="LVM基本原理及使用"><meta property="og:url" content="http://www.gzwzh1994.com/2016/04/16/LVM基本原理及使用/index.html"><meta property="og:site_name" content="gzwzh1994的博客"><meta property="og:description" content="LVM简介
LVM全称Logical Volume Manager(逻辑卷管理)，是将几个物理分区(或硬盘)通过软件组合成一块看起来是独立大硬盘(VG)，然后对这块大硬盘分割成可使用的逻辑卷(LV)，最终能够挂载使用，以达到对磁盘空间进行弹性管理的目的。


LVM的基本原理基本术语dm(device mapper)：将一个或多个底层块设备组织成一个逻辑设备的模块PV(Physical Volum"><meta property="og:image" content="http://static.zybuluo.com/gzwzh1994/2o95fnf6ia4p36k2vz66jizy/620px-Lvm.svg.png"><meta property="og:updated_time" content="2016-04-17T14:31:00.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="LVM基本原理及使用"><meta name="twitter:description" content="LVM简介
LVM全称Logical Volume Manager(逻辑卷管理)，是将几个物理分区(或硬盘)通过软件组合成一块看起来是独立大硬盘(VG)，然后对这块大硬盘分割成可使用的逻辑卷(LV)，最终能够挂载使用，以达到对磁盘空间进行弹性管理的目的。


LVM的基本原理基本术语dm(device mapper)：将一个或多个底层块设备组织成一个逻辑设备的模块PV(Physical Volum"><meta name="twitter:image" content="http://static.zybuluo.com/gzwzh1994/2o95fnf6ia4p36k2vz66jizy/620px-Lvm.svg.png"><script type="text/javascript" id="hexo.configuration">var NexT=window.NexT||{},CONFIG={scheme:"Mist",sidebar:{position:"left",display:"hide"},fancybox:!0,motion:!0,duoshuo:{userId:0,author:"博主"}}</script><title> LVM基本原理及使用 | gzwzh1994的博客</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?a8b1db5a4a7afe6d407861a40952d9ae";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">gzwzh1994的博客</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-home fa-fw"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-th fa-fw"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-archive fa-fw"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-tags fa-fw"></i><br> 标签</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline"> LVM基本原理及使用</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time itemprop="dateCreated" datetime="2016-04-16T15:49:00+08:00" content="2016-04-16">2016-04-16</time></span> <span class="post-category">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span></span> <span id="/2016/04/16/LVM基本原理及使用/" class="leancloud_visitors" data-flag-title="LVM基本原理及使用">&nbsp; | &nbsp;<span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数</span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="LVM简介"><a href="#LVM简介" class="headerlink" title="LVM简介"></a>LVM简介</h2><blockquote><p>LVM全称Logical Volume Manager(逻辑卷管理)，是将几个物理分区(或硬盘)通过软件组合成一块看起来是独立大硬盘(VG)，然后对这块大硬盘分割成可使用的逻辑卷(LV)，最终能够挂载使用，以达到对磁盘空间进行弹性管理的目的。</p></blockquote><hr><h2 id="LVM的基本原理"><a href="#LVM的基本原理" class="headerlink" title="LVM的基本原理"></a>LVM的基本原理</h2><h3 id="基本术语"><a href="#基本术语" class="headerlink" title="基本术语"></a>基本术语</h3><p><strong>dm(device mapper)</strong>：将一个或多个底层块设备组织成一个逻辑设备的模块<br><strong>PV(Physical Volume，物理卷)</strong>：物理分区(或硬盘)通过 fdisk 调整系统识别码 (system ID) 成为 8e (LVM 的识别码)，然后再经过 pvcreate 的命令将他转成 LVM 最底层的物理卷(PV)<br><strong>VG(Volume Group，卷组)</strong>：由多个 PV 整合而成，每个 VG 最多能包含 65534 个 PE<br><strong>PE(Physical Extend,物理块)</strong>：LVM 最小的储存区块，默认大小 4MB。文件数据都是藉由写入 PE 来处理的。<br><strong>LV(Logical Volume，逻辑卷)</strong>：类似于非 LVM 系统中的磁盘分区，逻辑卷建立在卷组 VG 之上，有多个 PE组成<br><strong>LE(Logical Extent，逻辑卷)</strong>：LV 中的 PE 称为 LE<br><a id="more"></a></p><h3 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h3><p>物理分区(或硬盘)转化为PV，基于PV创建VG，VG包含若干个PE，通过划分VG中的PE组成LV，LV格式化成文件系统，最终进行挂载。</p><h3 id="原理图"><a href="#原理图" class="headerlink" title="原理图"></a>原理图</h3><p><img src="http://static.zybuluo.com/gzwzh1994/2o95fnf6ia4p36k2vz66jizy/620px-Lvm.svg.png" alt="LVM原理图"><br>注：图片来自维基百科</p><hr><h2 id="LVM的使用"><a href="#LVM的使用" class="headerlink" title="LVM的使用"></a>LVM的使用</h2><h3 id="相关工具及命令"><a href="#相关工具及命令" class="headerlink" title="相关工具及命令"></a>相关工具及命令</h3><ul><li>PV管理工具</li></ul><p><strong>pvs</strong>：简要PV信息显示<br><strong>pvdisplay</strong>：显示PV的详细信息<br><strong>pvcreate /dev/DEVICE</strong>：创建PV</p><ul><li>VG管理工具</li></ul><p><strong>vgs</strong>：简要VG显示信息<br><strong>vgdisplay</strong>：显示VG的详细信息<br><strong>vgcreate [-s #[kKmMgGtTpPeE]] VolumeGroupName PhysicalDevicePath [PhysicalDevicePath…]</strong>：创建VG<br><strong>vgextend VolumeGroupName PhysicalDevicePath [PhysicalDevicePath…]</strong>：扩展VG<br><strong>vgreduce VolumeGroupName PhysicalDevicePath [PhysicalDevicePath…]</strong>：缩减VG<br><strong>vgremove</strong>：移除VG<br>注意：对VG做减法时，先做pvmove，把需要移除的pv上的pe先移到同一卷组中其他pv上</p><ul><li>LV管理工具</li></ul><p><strong>lvs</strong>：简要LV信息显示<br><strong>lvdisplay</strong>：显示LV的详细信息<br><strong>lvcreate -L #[mMgGtT] -n NAME VolumeGroup</strong>：创建LV<br><strong>lvremove /dev/VG_NAME/LV_NAME</strong>：移除LV</p><ul><li>扩展逻辑卷</li></ul><p><strong>lvextend -L [+]#[mMgGtT] /dev/VG_NAME/LV_NAME</strong><br>-L #：扩展至#大小<br>-L +#：扩展#大小<br><strong>resize2fs /dev/VG_NAME/LV_NAME</strong>：重新定义文件系统的大小</p><ul><li>缩减逻辑卷</li></ul><p><strong>umount /dev/VG_NAME/LV_NAME</strong>：卸载指定的LV挂载<br><strong>e2fsck -f /dev/VG_NAME/LV_NAME</strong>：检查文件系统<br><strong>resize2fs /dev/VG_NAME/LV_NAME #[mMgGtT]</strong>：重新定义LV的大小<br><strong>lvreduce -L [-]#[mMgGtT] /dev/VG_NAME/LV_NAME</strong>：缩减LV大小<br><strong>mount</strong></p><ul><li>快照(snapshot)</li></ul><p><strong>lvcreate -L #[mMgGtT] -p r -s -n snapshot_lv_name original_lv_name</strong>：创建快照</p><h3 id="LVM的创建"><a href="#LVM的创建" class="headerlink" title="LVM的创建"></a>LVM的创建</h3><blockquote><p>目标：创建一个有两个PV组成的大小为20G的名为testvg的VG；要求PE大小为16MB, 而后在卷组中创建大小为5G的逻辑卷testlv；挂载至/users目录</p></blockquote><ul><li>系统环境</li></ul><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">操作系统：CentOS <span class="number">6</span>.<span class="number">7</span></span><br><span class="line">磁盘信息：</span><br><span class="line"><span class="symbol">Disk</span> /dev/sda: <span class="number">128</span>.<span class="number">8</span> GB, <span class="number">128849018880</span> <span class="keyword">bytes</span><br><span class="line"></span><span class="number">255</span> heads, <span class="number">63</span> sectors/track, <span class="number">15665</span> cylinders</span><br><span class="line"><span class="symbol">Units</span> = cylinders of <span class="number">16065</span> * <span class="number">512</span> = <span class="number">8225280</span> <span class="keyword">bytes</span><br><span class="line"></span><span class="symbol">Sector</span> size (logical/physical): <span class="number">512</span> <span class="keyword">bytes </span>/ <span class="number">512</span> <span class="keyword">bytes</span><br><span class="line"></span>I/O size (minimum/optimal): <span class="number">512</span> <span class="keyword">bytes </span>/ <span class="number">512</span> <span class="keyword">bytes</span><br><span class="line"></span><span class="symbol">Disk</span> identifier: <span class="number">0x00013624</span></span><br><span class="line"></span><br><span class="line">   Device <span class="keyword">Boot </span>     Start         <span class="meta">End</span>      <span class="keyword">Blocks </span>  Id  System</span><br><span class="line">/dev/sda1   *           <span class="number">1</span>          <span class="number">64</span>      <span class="number">512000</span>   <span class="number">83</span>  Linux</span><br><span class="line"><span class="symbol">Partition</span> <span class="number">1</span> does not <span class="meta">end</span> on cylinder <span class="keyword">boundary.</span><br><span class="line"></span>/dev/sda2              <span class="number">64</span>       <span class="number">15666</span>   <span class="number">125316096</span>   <span class="number">8</span>e  Linux LVM</span><br><span class="line"></span><br><span class="line"><span class="symbol">Disk</span> /dev/sdb: <span class="number">32</span>.<span class="number">2</span> GB, <span class="number">32212254720</span> <span class="keyword">bytes</span><br><span class="line"></span><span class="number">255</span> heads, <span class="number">63</span> sectors/track, <span class="number">3916</span> cylinders</span><br><span class="line"><span class="symbol">Units</span> = cylinders of <span class="number">16065</span> * <span class="number">512</span> = <span class="number">8225280</span> <span class="keyword">bytes</span><br><span class="line"></span><span class="symbol">Sector</span> size (logical/physical): <span class="number">512</span> <span class="keyword">bytes </span>/ <span class="number">512</span> <span class="keyword">bytes</span><br><span class="line"></span>I/O size (minimum/optimal): <span class="number">512</span> <span class="keyword">bytes </span>/ <span class="number">512</span> <span class="keyword">bytes</span><br><span class="line"></span><span class="symbol">Disk</span> identifier: <span class="number">0x00000000</span></span><br></pre></td></tr></table></figure><ul><li>初始化磁盘分区</li></ul><p>注：为简便操作，实验将基于sdb盘的物理分区<br></p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[<span class="name">root@centos6</span> ~]# fdisk /dev/sdb</span><br><span class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</span><br><span class="line">Building a new DOS disklabel with disk identifier <span class="number">0</span>x6cd53b57.</span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">After that, of course, the previous content won<span class="symbol">'t</span> be recoverable.</span><br><span class="line"></span><br><span class="line">Warning: invalid flag <span class="number">0</span>x0000 of partition table <span class="number">4</span> will be corrected by w(<span class="name">rite</span>)</span><br><span class="line"></span><br><span class="line">WARNING: DOS-compatible mode is deprecated. It<span class="symbol">'s</span> strongly recommended to</span><br><span class="line">         switch off the mode (<span class="name">command</span> <span class="symbol">'c</span>') and change display units to</span><br><span class="line">         sectors (<span class="name">command</span> <span class="symbol">'u</span>').</span><br><span class="line"></span><br><span class="line">Command (<span class="name">m</span> for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (<span class="name">1-4</span>)</span><br><span class="line">p</span><br><span class="line">Partition number (<span class="name">1-4</span>): <span class="number">1</span></span><br><span class="line">First cylinder (<span class="name">1-3916</span>, default <span class="number">1</span>): </span><br><span class="line">Using default value <span class="number">1</span></span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (<span class="name">1-3916</span>, default <span class="number">3916</span>): <span class="number">+10</span>G</span><br><span class="line"></span><br><span class="line">Command (<span class="name">m</span> for help): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (<span class="name">1-4</span>)</span><br><span class="line">p</span><br><span class="line">Partition number (<span class="name">1-4</span>): <span class="number">2</span></span><br><span class="line">First cylinder (<span class="name">1307-3916</span>, default <span class="number">1307</span>): </span><br><span class="line">Using default value <span class="number">1307</span></span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (<span class="name">1307-3916</span>, default <span class="number">3916</span>): <span class="number">+10</span>G</span><br><span class="line"></span><br><span class="line">Command (<span class="name">m</span> for help): t</span><br><span class="line">Partition number (<span class="name">1-4</span>): <span class="number">1</span></span><br><span class="line">Hex code (<span class="name">type</span> L to list codes): <span class="number">8</span>e</span><br><span class="line">Changed system type of partition <span class="number">1</span> to <span class="number">8</span>e (<span class="name">Linux</span> LVM)</span><br><span class="line"></span><br><span class="line">Command (<span class="name">m</span> for help): t</span><br><span class="line">Partition number (<span class="name">1-4</span>): <span class="number">2</span></span><br><span class="line">Hex code (<span class="name">type</span> L to list codes): <span class="number">8</span>e</span><br><span class="line">Changed system type of partition <span class="number">2</span> to <span class="number">8</span>e (<span class="name">Linux</span> LVM)</span><br><span class="line"></span><br><span class="line">Command (<span class="name">m</span> for help): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line">[<span class="name">root@centos6</span> ~]# partx -a /dev/sdb    #通知内核重读分区表</span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition <span class="number">1</span></span><br><span class="line">BLKPG: Device or resource busy</span><br><span class="line">error adding partition <span class="number">2</span></span><br></pre></td></tr></table></figure><p></p><ul><li>创建PV</li></ul><figure class="highlight irpf90"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]# pvcreate /dev/sdb[<span class="number">1</span>-<span class="number">2</span>]</span><br><span class="line">  Physical volume <span class="string">"/dev/sdb1"</span> successfully created</span><br><span class="line">  Physical volume <span class="string">"/dev/sdb2"</span> successfully created</span><br><span class="line">[root@centos6 ~]# pvs /dev/sdb*      #查看简要信息，单独pvs显示所有PV</span><br><span class="line">  PV         VG         <span class="keyword">Fmt</span>  Attr PSize   PFree </span><br><span class="line">  /dev/sdb1             lvm2 ---   <span class="number">10.</span>0g <span class="number">10.</span>0g</span><br><span class="line">  /dev/sdb2             lvm2 ---   <span class="number">10.</span>0g <span class="number">10.</span>0g</span><br><span class="line">[root@centos6 ~]# pvdisplay /dev/sdb*  #查看详细信息，单独pvdisplay显示所有PV</span><br><span class="line">  Failed to find device for physical volume <span class="string">"/dev/sdb"</span>.</span><br><span class="line">  <span class="string">"/dev/sdb1"</span> is a new physical volume of <span class="string">"10.00 GiB"</span></span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV <span class="keyword">Name</span>               /dev/sdb1</span><br><span class="line">  VG <span class="keyword">Name</span>               </span><br><span class="line">  PV <span class="built_in">Size</span>               <span class="number">10.00</span> GiB</span><br><span class="line">  <span class="keyword">Allocatable</span>           NO</span><br><span class="line">  PE <span class="built_in">Size</span>               <span class="number">0</span>   </span><br><span class="line">  Total PE              <span class="number">0</span></span><br><span class="line">  <span class="keyword">Free</span> PE               <span class="number">0</span></span><br><span class="line">  <span class="built_in">Allocated</span> PE          <span class="number">0</span></span><br><span class="line">  PV UUID               fRfYN1-N1xX-VBtQ-u4hH-FKjd-OSGL-N1n6b1</span><br><span class="line">   </span><br><span class="line">  <span class="string">"/dev/sdb2"</span> is a new physical volume of <span class="string">"10.00 GiB"</span></span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV <span class="keyword">Name</span>               /dev/sdb2</span><br><span class="line">  VG <span class="keyword">Name</span>               </span><br><span class="line">  PV <span class="built_in">Size</span>               <span class="number">10.00</span> GiB</span><br><span class="line">  <span class="keyword">Allocatable</span>           NO</span><br><span class="line">  PE <span class="built_in">Size</span>               <span class="number">0</span>   </span><br><span class="line">  Total PE              <span class="number">0</span></span><br><span class="line">  <span class="keyword">Free</span> PE               <span class="number">0</span></span><br><span class="line">  <span class="built_in">Allocated</span> PE          <span class="number">0</span></span><br><span class="line">  PV UUID               fjJ8ED-VTVk-IJb-DCdx-2Bl-Go7g-wApVuK</span><br></pre></td></tr></table></figure><ul><li>创建VG</li></ul><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]<span class="meta"># vgcreate -s <span class="number">16</span> testvg /dev/sdb[<span class="number">1</span>-<span class="number">2</span>]  #创建名为testvg PE大小为<span class="number">16</span>MB的卷组</span></span><br><span class="line">  Volume <span class="built_in">group</span> <span class="string">"testvg"</span> successfully created</span><br><span class="line">[root@centos6 ~]<span class="meta"># vgs testvg   #可根据VG名称查找</span></span><br><span class="line">  VG     <span class="meta">#PV #LV #SN Attr   VSize  VFree </span></span><br><span class="line">  testvg   <span class="number">2</span>   <span class="number">0</span>   <span class="number">0</span> wz--n- <span class="number">20.00</span>g <span class="number">20.00</span>g</span><br><span class="line">[root@centos6 ~]<span class="meta"># vgdisplay testvg   #可根据VG名称查找</span></span><br><span class="line">  --- Volume <span class="built_in">group</span> ---</span><br><span class="line">  VG <span class="built_in">Name</span>               testvg</span><br><span class="line">  System ID             </span><br><span class="line">  <span class="built_in">Format</span>                lvm2</span><br><span class="line">  Metadata Areas        <span class="number">2</span></span><br><span class="line">  Metadata Sequence No  <span class="number">1</span></span><br><span class="line">  VG Access             read/write</span><br><span class="line">  VG Status             resizable</span><br><span class="line">  <span class="built_in">MAX</span> LV                <span class="number">0</span></span><br><span class="line">  Cur LV                <span class="number">0</span></span><br><span class="line">  Open LV               <span class="number">0</span></span><br><span class="line">  <span class="built_in">Max</span> PV                <span class="number">0</span></span><br><span class="line">  Cur PV                <span class="number">2</span></span><br><span class="line">  Act PV                <span class="number">2</span></span><br><span class="line">  VG <span class="built_in">Size</span>               <span class="number">20.00</span> GiB</span><br><span class="line">  PE <span class="built_in">Size</span>               <span class="number">16.00</span> MiB</span><br><span class="line">  Total PE              <span class="number">1280</span></span><br><span class="line">  Alloc PE / <span class="built_in">Size</span>       <span class="number">0</span> / <span class="number">0</span>   </span><br><span class="line">  Free  PE / <span class="built_in">Size</span>       <span class="number">1280</span> / <span class="number">20.00</span> GiB</span><br><span class="line">  VG UUID               QPvR7X-<span class="number">2</span>uRS-U8Ba-Kzz5-Z1Z0-WZ2i-WkkBpB</span><br></pre></td></tr></table></figure><ul><li>创建LV</li></ul><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]# lvcreate -<span class="keyword">L</span> 5g -<span class="keyword">n</span> testlv testvg   #在testvg下创建容量为5G名称为testlv的<span class="keyword">LV</span></span><br><span class="line">  Logical volume <span class="string">"testlv"</span> created.</span><br><span class="line">[root@centos6 ~]# lvs /dev/testvg</span><br><span class="line">  <span class="keyword">LV</span>     VG     Attr       LSize Pool Origin Data%  Meta%  <span class="keyword">Move</span> <span class="keyword">Log</span> Cpy%Sync Convert</span><br><span class="line">  testlv testvg -wi-a----- 5.00g                                                    </span><br><span class="line">[root@centos6 ~]# lvs /dev/testvg/testlv </span><br><span class="line">  <span class="keyword">LV</span>     VG     Attr       LSize Pool Origin Data%  Meta%  <span class="keyword">Move</span> <span class="keyword">Log</span> Cpy%Sync Convert</span><br><span class="line">  testlv testvg -wi-a----- 5.00g                                                    </span><br><span class="line">[root@centos6 ~]# lvdisplay /dev/testvg/testlv </span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  <span class="keyword">LV</span> Path                /dev/testvg/testlv</span><br><span class="line">  <span class="keyword">LV</span> Name                testlv</span><br><span class="line">  VG Name                testvg</span><br><span class="line">  <span class="keyword">LV</span> UUID                JNTrHH-bx2p-Z5k2-U6Cx-Fboi-BnGn-nNlqmZ</span><br><span class="line">  <span class="keyword">LV</span> Write Access        <span class="keyword">read</span>/write</span><br><span class="line">  <span class="keyword">LV</span> Creation host, time centos6.7, 2016-04-17 16:39:15 +0800</span><br><span class="line">  <span class="keyword">LV</span> Status              available</span><br><span class="line">  # <span class="keyword">open</span>                 0</span><br><span class="line">  <span class="keyword">LV</span> Size                5.00 GiB</span><br><span class="line">  Current LE             320</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  <span class="keyword">Read</span> ahead sectors     auto</span><br><span class="line"> - currently <span class="keyword">set</span> to     256</span><br><span class="line">  Block device           253:3</span><br></pre></td></tr></table></figure><ul><li>LV格式化及挂载</li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]<span class="comment"># mke2fs -t ext4 /dev/testvg/testlv </span></span><br><span class="line">mke2fs <span class="number">1.41</span><span class="number">.12</span> (<span class="number">17</span>-May<span class="number">-2010</span>)</span><br><span class="line">文件系统标签=</span><br><span class="line">操作系统:Linux</span><br><span class="line">块大小=<span class="number">4096</span> (<span class="built_in">log</span>=<span class="number">2</span>)</span><br><span class="line">分块大小=<span class="number">4096</span> (<span class="built_in">log</span>=<span class="number">2</span>)</span><br><span class="line">Stride=<span class="number">0</span> blocks, Stripe width=<span class="number">0</span> blocks</span><br><span class="line"><span class="number">327680</span> inodes, <span class="number">1310720</span> blocks</span><br><span class="line"><span class="number">65536</span> blocks (<span class="number">5.00</span>%) reserved <span class="keyword">for</span> <span class="keyword">the</span> super user</span><br><span class="line">第一个数据块=<span class="number">0</span></span><br><span class="line">Maximum filesystem blocks=<span class="number">1342177280</span></span><br><span class="line"><span class="number">40</span> block groups</span><br><span class="line"><span class="number">32768</span> blocks per group, <span class="number">32768</span> fragments per group</span><br><span class="line"><span class="number">8192</span> inodes per group</span><br><span class="line">Superblock backups stored <span class="keyword">on</span> blocks: </span><br><span class="line">	<span class="number">32768</span>, <span class="number">98304</span>, <span class="number">163840</span>, <span class="number">229376</span>, <span class="number">294912</span>, <span class="number">819200</span>, <span class="number">884736</span></span><br><span class="line"></span><br><span class="line">正在写入inode表: 完成                            </span><br><span class="line">Creating journal (<span class="number">32768</span> blocks): 完成</span><br><span class="line">Writing superblocks <span class="keyword">and</span> filesystem accounting information: 完成</span><br><span class="line"></span><br><span class="line">This filesystem will be automatically checked <span class="keyword">every</span> <span class="number">20</span> mounts <span class="keyword">or</span></span><br><span class="line"><span class="number">180</span> days, whichever comes <span class="keyword">first</span>.  Use tune2fs -c <span class="keyword">or</span> -i <span class="keyword">to</span> override.</span><br><span class="line">[root@centos6 ~]<span class="comment"># mkdir /users  #创建users目录</span></span><br><span class="line">[root@centos6 ~]<span class="comment"># mount /dev/testvg/testlv /users/ 将LV挂载到users目录</span></span><br><span class="line">[root@centos6 ~]<span class="comment"># mount #查看是否挂载成功</span></span><br><span class="line">/dev/mapper/vg_centos6-lv_root <span class="keyword">on</span> / type ext4 (rw)</span><br><span class="line">proc <span class="keyword">on</span> /proc type proc (rw)</span><br><span class="line">sysfs <span class="keyword">on</span> /sys type sysfs (rw)</span><br><span class="line">devpts <span class="keyword">on</span> /dev/pts type devpts (rw,gid=<span class="number">5</span>,mode=<span class="number">620</span>)</span><br><span class="line">tmpfs <span class="keyword">on</span> /dev/shm type tmpfs (rw,rootcontext=<span class="string">"system_u:object_r:tmpfs_t:s0"</span>)</span><br><span class="line">/dev/sda1 <span class="keyword">on</span> /boot type ext4 (rw)</span><br><span class="line">/dev/mapper/vg_centos6-lv_home <span class="keyword">on</span> /home type ext4 (rw)</span><br><span class="line">none <span class="keyword">on</span> /proc/sys/fs/binfmt_misc type binfmt_misc (rw)</span><br><span class="line">/dev/mapper/testvg-testlv <span class="keyword">on</span> /users type ext4 (rw)  <span class="comment">#表示已经挂载成功</span></span><br><span class="line">[root@centos6 ~]<span class="comment"># df -lh        #查看分区情况</span></span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted <span class="keyword">on</span></span><br><span class="line">/dev/mapper/vg_centos6-lv_root</span><br><span class="line">                       <span class="number">50</span>G  <span class="number">3.9</span>G   <span class="number">43</span>G   <span class="number">9</span>% /</span><br><span class="line">tmpfs                 <span class="number">491</span>M     <span class="number">0</span>  <span class="number">491</span>M   <span class="number">0</span>% /dev/shm</span><br><span class="line">/dev/sda1             <span class="number">477</span>M   <span class="number">37</span>M  <span class="number">416</span>M   <span class="number">9</span>% /boot</span><br><span class="line">/dev/mapper/vg_centos6-lv_home</span><br><span class="line">                       <span class="number">67</span>G   <span class="number">54</span>M   <span class="number">63</span>G   <span class="number">1</span>% /home</span><br><span class="line">/dev/mapper/testvg-testlv</span><br><span class="line">                      <span class="number">4.8</span>G   <span class="number">10</span>M  <span class="number">4.6</span>G   <span class="number">1</span>% /users</span><br></pre></td></tr></table></figure><h3 id="LVM的扩展"><a href="#LVM的扩展" class="headerlink" title="LVM的扩展"></a>LVM的扩展</h3><ul><li>VG扩展</li></ul><p>注：sdb3空间大小为5G，创建过程省略<br></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]<span class="comment"># vgextend testvg /dev/sdb3    #扩展testvg，将sdb3的空间提供给testvg</span></span><br><span class="line">  <span class="keyword">Volume</span> <span class="bash">group <span class="string">"testvg"</span> successfully extended</span><br><span class="line"></span>[root@centos6 ~]<span class="comment"># vgs testvg   #查看扩展后的容量</span></span><br><span class="line">  VG     <span class="comment">#PV #LV #SN Attr   VSize  VFree </span></span><br><span class="line">  testvg   3   1   0 wz--n- 25.00g 20.00g   <span class="comment">#成功扩展5G容量</span></span><br></pre></td></tr></table></figure><p></p><ul><li>LV扩展</li></ul><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]<span class="comment"># lvextend -L +10g /dev/testvg/testlv #扩展10G空间给testlv</span></span><br><span class="line">  Size <span class="keyword">of</span> logical volume testvg/testlv changed <span class="keyword">from</span> <span class="number">5.00</span> GiB (<span class="number">320</span> extents) <span class="keyword">to</span> <span class="number">15.00</span> GiB (<span class="number">960</span> extents).</span><br><span class="line">  Logical volume testlv successfully resized</span><br><span class="line">[root@centos6 ~]<span class="comment"># lvs /dev/testvg/testlv #查看testlv信息，空间大小为15G</span></span><br><span class="line">  LV     VG     Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  testlv testvg -wi-ao<span class="comment">---- 15.00g</span></span><br><span class="line">[root@centos6 ~]<span class="comment"># df -lh</span></span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted <span class="keyword">on</span></span><br><span class="line">/dev/mapper/vg_centos6-lv_root</span><br><span class="line">                       <span class="number">50</span>G  <span class="number">3.9</span>G   <span class="number">43</span>G   <span class="number">9</span>% /</span><br><span class="line">tmpfs                 <span class="number">491</span>M     <span class="number">0</span>  <span class="number">491</span>M   <span class="number">0</span>% /dev/shm</span><br><span class="line">/dev/sda1             <span class="number">477</span>M   <span class="number">37</span>M  <span class="number">416</span>M   <span class="number">9</span>% /boot</span><br><span class="line">/dev/mapper/vg_centos6-lv_home</span><br><span class="line">                       <span class="number">67</span>G   <span class="number">54</span>M   <span class="number">63</span>G   <span class="number">1</span>% /home</span><br><span class="line">/dev/mapper/testvg-testlv</span><br><span class="line">                      <span class="number">4.8</span>G   <span class="number">10</span>M  <span class="number">4.6</span>G   <span class="number">1</span>% /users   <span class="comment">#分区空间不变，扩展的空间生效需要重新定义分区大小</span></span><br><span class="line">[root@centos6 ~]<span class="comment"># resize2fs /dev/testvg/testlv  #分区大小重新定义</span></span><br><span class="line">resize2fs <span class="number">1.41</span><span class="number">.12</span> (<span class="number">17</span>-May<span class="number">-2010</span>)</span><br><span class="line">Filesystem <span class="keyword">at</span> /dev/testvg/testlv <span class="keyword">is</span> mounted <span class="keyword">on</span> /users; <span class="keyword">on</span>-line resizing required</span><br><span class="line">old desc_blocks = <span class="number">1</span>, new_desc_blocks = <span class="number">1</span></span><br><span class="line">Performing an <span class="keyword">on</span>-line resize <span class="keyword">of</span> /dev/testvg/testlv <span class="keyword">to</span> <span class="number">3932160</span> (<span class="number">4</span>k) blocks.</span><br><span class="line">The filesystem <span class="keyword">on</span> /dev/testvg/testlv <span class="keyword">is</span> now <span class="number">3932160</span> blocks long.</span><br><span class="line">[root@centos6 ~]<span class="comment"># df -lh</span></span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted <span class="keyword">on</span></span><br><span class="line">/dev/mapper/vg_centos6-lv_root</span><br><span class="line">                       <span class="number">50</span>G  <span class="number">3.9</span>G   <span class="number">43</span>G   <span class="number">9</span>% /</span><br><span class="line">tmpfs                 <span class="number">491</span>M     <span class="number">0</span>  <span class="number">491</span>M   <span class="number">0</span>% /dev/shm</span><br><span class="line">/dev/sda1             <span class="number">477</span>M   <span class="number">37</span>M  <span class="number">416</span>M   <span class="number">9</span>% /boot</span><br><span class="line">/dev/mapper/vg_centos6-lv_home</span><br><span class="line">                       <span class="number">67</span>G   <span class="number">54</span>M   <span class="number">63</span>G   <span class="number">1</span>% /home</span><br><span class="line">/dev/mapper/testvg-testlv</span><br><span class="line">                       <span class="number">15</span>G   <span class="number">13</span>M   <span class="number">14</span>G   <span class="number">1</span>% /users   <span class="comment">#扩展空间已经生效</span></span><br></pre></td></tr></table></figure><p>注：如果文件系统是处于mount状态下，resize2fs命令只能做到扩容</p><h3 id="LVM缩减"><a href="#LVM缩减" class="headerlink" title="LVM缩减"></a>LVM缩减</h3><blockquote><p>注：LVM缩减有风险，操作需谨慎</p></blockquote><ul><li>VG缩减</li></ul><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@ce<span class="symbol">ntos6</span> ~]<span class="attr"># pvs -o+pv_used  #查看pv的已使用情况</span><br><span class="line">  PV         VG         Fmt  Attr PSize   PFree Used   </span><br><span class="line">  /dev/sda2</span>  vg_ce<span class="symbol">ntos6</span> lv<span class="name">m2</span> a--  <span class="number">119.51</span>g    <span class="number">0</span>  <span class="number">119.51</span>g</span><br><span class="line">  /dev/sdb<span class="number">1</span>  testvg     lv<span class="name">m2</span> a--   <span class="number">10.00</span>g    <span class="number">0</span>   <span class="number">10.00</span>g</span><br><span class="line">  /dev/sdb<span class="number">2</span>  testvg     lv<span class="name">m2</span> a--   <span class="number">10.00</span>g <span class="number">5.00</span>g   <span class="number">5.00</span>g</span><br><span class="line">  /dev/sdb<span class="number">3</span>  testvg     lv<span class="name">m2</span> a--    <span class="number">5.00</span>g <span class="number">5.00</span>g      <span class="number">0</span> </span><br><span class="line">[root@ce<span class="symbol">ntos6</span> ~]<span class="attr"># pvmove /dev/sdb2</span> /dev/sdb<span class="number">3</span>  <span class="attr">#防止数据丢失将sdb2</span>非空闲的PE与sdb<span class="number">3</span>的空间PE交换</span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">0.3</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">6.2</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">14.1</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">21.6</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">27.2</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">34.4</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">40.6</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">48.1</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">54.7</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">60.9</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">67.8</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">74.1</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">80.6</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">87.8</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">93.4</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">98.8</span><span class="meta">%</span></span><br><span class="line">  /dev/sdb<span class="number">2</span>: Moved: <span class="number">100.0</span><span class="meta">%</span></span><br><span class="line">[root@ce<span class="symbol">ntos6</span> ~]<span class="attr"># pvs -o+pv_used</span><br><span class="line">  PV         VG         Fmt  Attr PSize   PFree  Used   </span><br><span class="line">  /dev/sda2</span>  vg_ce<span class="symbol">ntos6</span> lv<span class="name">m2</span> a--  <span class="number">119.51</span>g     <span class="number">0</span>  <span class="number">119.51</span>g</span><br><span class="line">  /dev/sdb<span class="number">1</span>  testvg     lv<span class="name">m2</span> a--   <span class="number">10.00</span>g     <span class="number">0</span>   <span class="number">10.00</span>g</span><br><span class="line">  /dev/sdb<span class="number">2</span>  testvg     lv<span class="name">m2</span> a--   <span class="number">10.00</span>g <span class="number">10.00</span>g      <span class="number">0</span>   <span class="attr">#此pv已经空闲，可进行缩减VG</span><br><span class="line">  /dev/sdb3</span>  testvg     lv<span class="name">m2</span> a--    <span class="number">5.00</span>g     <span class="number">0</span>    <span class="number">5.00</span>g</span><br><span class="line">[root@ce<span class="symbol">ntos6</span> ~]<span class="attr"># vgreduce testvg /dev/sdb2</span>  <span class="attr">#缩减VG</span><br><span class="line">  Removed "/dev/sdb2</span><span class="string">" from volume group "</span>testvg<span class="string">"</span><br><span class="line">[root@centos6 ~]# vgs testvg </span><br><span class="line">  VG     #PV #LV #SN Attr   VSize  VFree</span><br><span class="line">  testvg   2   1   0 wz--n- 15.00g    0     #成功缩减VG</span></span><br></pre></td></tr></table></figure><ul><li>LV缩减</li></ul><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 ~]<span class="comment"># umount /users/  #卸载挂载目录</span></span><br><span class="line">[root@centos6 ~]<span class="comment"># e2fsck -f /dev/testvg/testlv   #检查文件系统，该步骤不可少</span></span><br><span class="line">e2fsck <span class="number">1.41</span>.<span class="number">12</span> (<span class="number">17</span>-May-<span class="number">2010</span>)</span><br><span class="line">第一步: 检查inode,块,和大小</span><br><span class="line">第二步: 检查目录结构</span><br><span class="line">第<span class="number">3</span>步: 检查目录连接性</span><br><span class="line">Pass <span class="number">4</span>: Checking reference counts</span><br><span class="line">第<span class="number">5</span>步: 检查簇概要信息</span><br><span class="line">/dev/testvg/testlv: <span class="number">11</span>/<span class="number">983040</span> files (<span class="number">0.0</span>% non-contiguous), <span class="number">97664</span>/<span class="number">3932160</span> blocks</span><br><span class="line">[root@centos6 ~]<span class="comment"># resize2fs /dev/testvg/testlv 10g</span></span><br><span class="line">resize2fs <span class="number">1.41</span>.<span class="number">12</span> (<span class="number">17</span>-May-<span class="number">2010</span>)</span><br><span class="line">Resizing the filesystem <span class="literal">on</span> /dev/testvg/testlv <span class="keyword">to</span> <span class="number">2621440</span> (<span class="number">4k</span>) blocks.</span><br><span class="line">The filesystem <span class="literal">on</span> /dev/testvg/testlv <span class="keyword">is</span> now <span class="number">2621440</span> blocks long.</span><br><span class="line">[root@centos6 ~]<span class="comment"># lvreduce -L -5g /dev/testvg/testlv  #缩减5G LV的空间</span></span><br><span class="line">  WARNING: Reducing active logical volume <span class="keyword">to</span> <span class="number">10.00</span> GiB</span><br><span class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</span><br><span class="line">Do you really want <span class="keyword">to</span> reduce testlv? [y/n]: y</span><br><span class="line">  Size <span class="keyword">of</span> logical volume testvg/testlv changed <span class="keyword">from</span> <span class="number">15.00</span> GiB (<span class="number">960</span> extents) <span class="keyword">to</span> <span class="number">10.00</span> GiB (<span class="number">640</span> extents).</span><br><span class="line">  Logical volume testlv successfully resized</span><br><span class="line">[root@centos6 ~]<span class="comment"># lvs /dev/testvg/testlv   #查看testlv信息</span></span><br><span class="line">  LV     VG     Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  testlv testvg -wi-ao---- <span class="number">10.00g</span>                                                    </span><br><span class="line">[root@centos6 ~]<span class="comment"># mount /dev/testvg/testlv /users/   #重新挂载</span></span><br><span class="line">[root@centos6 ~]<span class="comment"># df -lh</span></span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted <span class="literal">on</span></span><br><span class="line">/dev/mapper/vg_centos6-lv_root</span><br><span class="line">                       <span class="number">50</span>G  <span class="number">3.9</span>G   <span class="number">43</span>G   <span class="number">9</span>% /</span><br><span class="line">tmpfs                 <span class="number">491</span>M     <span class="number">0</span>  <span class="number">491</span>M   <span class="number">0</span>% /dev/shm</span><br><span class="line">/dev/sda1             <span class="number">477</span>M   <span class="number">37</span>M  <span class="number">416</span>M   <span class="number">9</span>% /boot</span><br><span class="line">/dev/mapper/vg_centos6-lv_home</span><br><span class="line">                       <span class="number">67</span>G   <span class="number">54</span>M   <span class="number">63</span>G   <span class="number">1</span>% /home</span><br><span class="line">/dev/mapper/testvg-testlv</span><br><span class="line">                      <span class="number">9.8</span>G   <span class="number">12</span>M  <span class="number">9.3</span>G   <span class="number">1</span>% /users</span><br></pre></td></tr></table></figure><h3 id="快照"><a href="#快照" class="headerlink" title="快照"></a>快照</h3><blockquote><p>LVM快照功能是在在时间点上对快照源分区的所有文件的元数据进行保存，如果源数据未发生改变，则访问快照卷的相应文件将直接指向源分区的源文件，如源文件发生改变，旧数据将拷贝到快照卷的预留空间中起到备份数据的作用</p></blockquote><ul><li>快照创建</li></ul><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 users]<span class="comment"># cp /etc/fstab /users/</span></span><br><span class="line">[root@centos6 users]<span class="comment"># ls</span></span><br><span class="line">fstab  lost+found</span><br><span class="line">[root@centos6 users]<span class="comment"># cat fstab </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Fri Mar  4 11:09:09 2016</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="regexp">/dev/mapper/vg_centos6-lv_root /</span>                       ext4    defaults        <span class="number">1</span> <span class="number">1</span></span><br><span class="line">UUID=<span class="number">3</span>efc9d2d-ff60<span class="number">-4491</span><span class="number">-84</span>c4-e1beb6701b83 /boot                   ext4    defaults        <span class="number">1</span> <span class="number">2</span></span><br><span class="line">/dev/mapper/vg_centos6-lv_home /home                   ext4    defaults        <span class="number">1</span> <span class="number">2</span></span><br><span class="line">/dev/mapper/vg_centos6-lv_swap swap                    swap    defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line">sysfs                   /sys                    sysfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">proc                    /proc                   proc    defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">[root@centos6 users]<span class="comment"># lvcreate -L 5g -p r -s -n testlv-snap /dev/testvg/testlv #创建testlv的快照卷</span></span><br><span class="line">  Logical volume <span class="string">"testlv-snap"</span> created.</span><br><span class="line">[root@centos6 users]<span class="comment"># mkdir /backup</span></span><br><span class="line">[root@centos6 users]<span class="comment"># mount /dev/testvg/testlv-snap /backup/  #将快照卷挂载到/backup目录</span></span><br><span class="line">mount: block device /dev/mapper/testvg-testlv--snap <span class="keyword">is</span> write-protected, mounting read-only</span><br></pre></td></tr></table></figure><ul><li>测试</li></ul><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@centos6 users]<span class="comment"># vim fstab  #编辑源文件</span></span><br><span class="line">[root@centos6 users]<span class="comment"># cat fstab </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@centos6 users]<span class="comment"># cat /backup/fstab #查看快照卷中的文件，发现文件内容不变实现了备份</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Fri Mar  4 11:09:09 2016</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="regexp">/dev/mapper/vg_centos6-lv_root /</span>                       ext4    defaults        <span class="number">1</span> <span class="number">1</span></span><br><span class="line">UUID=<span class="number">3</span>efc9d2d-ff60<span class="number">-4491</span><span class="number">-84</span>c4-e1beb6701b83 /boot                   ext4    defaults        <span class="number">1</span> <span class="number">2</span></span><br><span class="line">/dev/mapper/vg_centos6-lv_home /home                   ext4    defaults        <span class="number">1</span> <span class="number">2</span></span><br><span class="line">/dev/mapper/vg_centos6-lv_swap swap                    swap    defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">devpts                  /dev/pts                devpts  gid=<span class="number">5</span>,mode=<span class="number">620</span>  <span class="number">0</span> <span class="number">0</span></span><br><span class="line">sysfs                   /sys                    sysfs   defaults        <span class="number">0</span> <span class="number">0</span></span><br><span class="line">proc                    /proc                   proc    defaults        <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></div><div></div><div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/LVM/" rel="tag">#LVM</a> <a href="/tags/Linux/" rel="tag">#Linux</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2016/04/10/常见RAID介绍/" rel="next" title="常见RAID介绍"><i class="fa fa-chevron-left"></i> 常见RAID介绍</a></div><div class="post-nav-prev post-nav-item"></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="gzwzh1994"><p class="site-author-name" itemprop="name">gzwzh1994</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives"><span class="site-state-item-count">5</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories"><span class="site-state-item-count">1</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags"><span class="site-state-item-count">10</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/gzwzh1994" target="_blank"><i class="fa fa-github"></i> GitHub</a></span></div><div class="links-of-blogroll motion-element"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#LVM简介"><span class="nav-number">1.</span> <span class="nav-text">LVM简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LVM的基本原理"><span class="nav-number">2.</span> <span class="nav-text">LVM的基本原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#基本术语"><span class="nav-number">2.1.</span> <span class="nav-text">基本术语</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#基本流程"><span class="nav-number">2.2.</span> <span class="nav-text">基本流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#原理图"><span class="nav-number">2.3.</span> <span class="nav-text">原理图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LVM的使用"><span class="nav-number">3.</span> <span class="nav-text">LVM的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#相关工具及命令"><span class="nav-number">3.1.</span> <span class="nav-text">相关工具及命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LVM的创建"><span class="nav-number">3.2.</span> <span class="nav-text">LVM的创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LVM的扩展"><span class="nav-number">3.3.</span> <span class="nav-text">LVM的扩展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LVM缩减"><span class="nav-number">3.4.</span> <span class="nav-text">LVM缩减</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#快照"><span class="nav-number">3.5.</span> <span class="nav-text">快照</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2016</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">gzwzh1994</span></div><div class="powered-by"> 由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动</div><div class="theme-info"> 主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("FxOjsFAHfwe9GUQwgokVUUhx-gzGzoHsz","uVlSnORqlDd8QQft8fqqv5zK")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var n=0;n<e.length;n++){var i=e[n],r=i.get("url"),l=i.get("time"),s=document.getElementById(r);$(s).find(t).text(l)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e;r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>